@using DodoPlanner.Services
@using DodoPlanner.Models
@using Microsoft.AspNetCore.Components.Web
@using DodoPlanner.Pages
@inject JsonFileTdListService tdlistservice

<h3>@tdlistservice.GetList(theListId).Title </h3>

 
@foreach (var task in tdlistservice.GetList(theListId).tasks)
{
    <div>
        @if (task.completed)
        {
            style = "text-decoration: line-through;";
        }
        else
        {
            style = string.Empty;
        }
        <p style="@style">
            @task.title  @task.duedate.ToString("MM/dd/yyyy") <input type="checkbox" checked="@task.completed" @onclick="( e=> ToggleCompleted(task.title))" />
        </p>
        
    </div>
}
<input @bind="newtasktitle" />
<input type="date" @bind ="newduedate" />
<button @onclick="(e => AddNewTask())">Add New Task </button>

@code {

    public string style { get; set; }

    private Guid theListId;

    [Parameter]
    public string ListId {
        get => theListId.ToString();
        set
        {
            theListId = Guid.Parse(value);
        }
    }


    string newtasktitle { get;
        set; }
    DateTime newduedate { get; set; }

    void AddNewTask()
    {
        var newTask = new task { title = newtasktitle, duedate = newduedate};
        tdlistservice.AddTask(newTask, theListId);
        newtasktitle = string.Empty;
        newduedate = DateTime.Now;
    }

    public void ToggleCompleted(string taskName)
    {
        tdlistservice.ToggleCompleted(theListId, taskName);
    }

    protected override void OnInitialized()
    {
        base.OnInitialized();
        newduedate = DateTime.Now;
    }
}
